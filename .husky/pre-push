#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the current branch
branch=$(git rev-parse --abbrev-ref HEAD)

# Prevent direct push to main/master
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "âŒ Direct push to $branch is not allowed!"
  echo "Please create a pull request instead."
  exit 1
fi

# Run full test suite before push
echo "ğŸ§ª Running full test suite..."
npm run test:all

# Run type checking
echo "ğŸ” Running type checks..."
npm run typecheck

# Run linting
echo "ğŸ§¹ Running linter..."
npm run lint

# Run security scan
echo "ğŸ” Running security scan..."
npm run security:audit

# Check for large files
echo "ğŸ“¦ Checking for large files..."
git diff --cached --name-only | xargs -I {} sh -c 'if [ -f "{}" ] && [ $(stat -f%z "{}" 2>/dev/null || stat -c%s "{}" 2>/dev/null) -gt 10485760 ]; then echo "âŒ File {} is larger than 10MB"; exit 1; fi'

echo "âœ… Pre-push checks completed successfully"