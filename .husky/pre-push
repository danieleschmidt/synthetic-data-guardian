#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the current branch
branch=$(git rev-parse --abbrev-ref HEAD)

# Prevent direct push to main/master
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "❌ Direct push to $branch is not allowed!"
  echo "Please create a pull request instead."
  exit 1
fi

# Run full test suite before push (disabled temporarily)
echo "🧪 Running full test suite... (skipped)"
# npm run test:all

# Run type checking (disabled temporarily)
echo "🔍 Running type checks... (skipped)"
# npm run typecheck

# Run linting (disabled temporarily)
echo "🧹 Running linter... (skipped)"
# npm run lint

# Run security scan (disabled temporarily)
echo "🔐 Running security scan... (skipped)"
# npm run security:audit

# Check for large files
echo "📦 Checking for large files..."
git diff --cached --name-only | xargs -I {} sh -c 'if [ -f "{}" ] && [ $(stat -f%z "{}" 2>/dev/null || stat -c%s "{}" 2>/dev/null) -gt 10485760 ]; then echo "❌ File {} is larger than 10MB"; exit 1; fi'

echo "✅ Pre-push checks completed successfully"